<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#39424E">
    <link rel="shortcut icon" href="/rawhttp/sam.ico" id="favicon">
    <title>RawHTTP</title>
    <link rel="stylesheet" href="/rawhttp/css/styles.css">
</head>
<body>
<div class="main-body"><nav class="main-nav">
    <a href="/rawhttp/index.html">Home</a>
    <a href="/rawhttp/docs/index.html">Docs</a>
    <a href="/rawhttp/rawhttp-modules/cli.html">CLI</a>
    <a href="/rawhttp/rawhttp-modules/duplex.html">Duplex</a>
    <a href="/rawhttp/rawhttp-modules/cookies.html">Cookies</a>
    <a href="/rawhttp/rawhttp-modules/req-in-edit.html">ReqInEdit</a>
</nav><h3>Send a GET request</h3>
<pre style="color:#93a1a1;background-color:#002b36"><span style="color:#719e07">import</span> <span style="color:#268bd2">rawhttp</span>.core.<span style="color:#719e07">*</span>;
<span style="color:#719e07">import</span> <span style="color:#268bd2">java</span>.net.Socket;

RawHttp <span style="color:#268bd2">http</span> <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> RawHttp();
RawHttpRequest <span style="color:#268bd2">request</span> <span style="color:#719e07">=</span> http.parseRequest(
    <span style="color:#2aa198">&#34;GET / HTTP/1.1\r\n&#34;</span> <span style="color:#719e07">+</span>
    <span style="color:#2aa198">&#34;Host: headers.jsontest.com\r\n&#34;</span> <span style="color:#719e07">+</span>
    <span style="color:#2aa198">&#34;User-Agent: RawHTTP\r\n&#34;</span> <span style="color:#719e07">+</span>
    <span style="color:#2aa198">&#34;Accept: application/json&#34;</span>);

Socket <span style="color:#268bd2">socket</span> <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> Socket(<span style="color:#2aa198">&#34;headers.jsontest.com&#34;</span>, 80);
request.writeTo(socket.getOutputStream());
</pre>
<h3>Send a POST request with a body</h3>
<pre style="color:#93a1a1;background-color:#002b36"><span style="color:#719e07">import</span> <span style="color:#268bd2">rawhttp</span>.core.<span style="color:#719e07">*</span>;
<span style="color:#719e07">import</span> <span style="color:#268bd2">java</span>.net.Socket;

String <span style="color:#268bd2">jsonBody</span> <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;{ \&#34;hello\&#34;: true, \&#34;raw_http\&#34;: \&#34;2.0\&#34; }&#34;</span>;
RawHttp <span style="color:#268bd2">http</span> <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> RawHttp();
RawHttpRequest <span style="color:#268bd2">request</span> <span style="color:#719e07">=</span> http.parseRequest(
    <span style="color:#2aa198">&#34;POST /post HTTP/1.1\r\n&#34;</span> <span style="color:#719e07">+</span>
    <span style="color:#2aa198">&#34;Host: httpbin.org\r\n&#34;</span> <span style="color:#719e07">+</span>
    <span style="color:#2aa198">&#34;User-Agent: RawHTTP\r\n&#34;</span> <span style="color:#719e07">+</span>
    <span style="color:#2aa198">&#34;Content-Length: &#34;</span> <span style="color:#719e07">+</span> jsonBody.length() <span style="color:#719e07">+</span> <span style="color:#2aa198">&#34;\r\n&#34;</span> <span style="color:#719e07">+</span>
    <span style="color:#2aa198">&#34;Content-Type: application/json\r\n&#34;</span> <span style="color:#719e07">+</span>
    <span style="color:#2aa198">&#34;Accept: application/json\r\n&#34;</span> <span style="color:#719e07">+</span>
    <span style="color:#2aa198">&#34;\r\n&#34;</span> <span style="color:#719e07">+</span>
    jsonBody);

Socket <span style="color:#268bd2">socket</span> <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> Socket(<span style="color:#2aa198">&#34;httpbin.org&#34;</span>, 80);
request.writeTo(socket.getOutputStream());
</pre>
<h3>Read a response</h3>

<p>&hellip; continues from the previous example:</p>
<pre style="color:#93a1a1;background-color:#002b36">RawHttpResponse<span style="color:#719e07">&lt;</span><span style="color:#719e07">?</span><span style="color:#719e07">&gt;</span> response <span style="color:#719e07">=</span> http.parseResponse(socket.getInputStream()).eagerly();
System.out.println(<span style="color:#2aa198">&#34;RESPONSE:\n&#34;</span> <span style="color:#719e07">+</span> response);

assertEquals(200, response.getStatusCode());
assertTrue(response.getBody().isPresent());

String <span style="color:#268bd2">textBody</span> <span style="color:#719e07">=</span> response.getBody().get().decodeBodyToString(UTF_8);
assertTrue(textBody.contains(jsonBody.replaceAll(<span style="color:#2aa198">&#34; &#34;</span>, <span style="color:#2aa198">&#34;&#34;</span>)));
</pre>
<h3>Check headers (in both request or response)</h3>

<p>&hellip; continues from the previous examples:</p>
<pre style="color:#93a1a1;background-color:#002b36">assertEquals(<span style="color:#2aa198">&#34;application/json&#34;</span>,
    request.getHeaders().getFirst(<span style="color:#2aa198">&#34;Accept&#34;</span>).orElse(<span style="color:#2aa198">&#34;&#34;</span>));

assertEquals(<span style="color:#2aa198">&#34;application/json&#34;</span>,
    response.getHeaders().getFirst(<span style="color:#2aa198">&#34;Content-Type&#34;</span>).orElse(<span style="color:#2aa198">&#34;&#34;</span>));

assertEquals(asList(<span style="color:#2aa198">&#34;application/json&#34;</span>),
    response.getHeaders().get(<span style="color:#2aa198">&#34;Content-Type&#34;</span>));

assertEquals(asList(<span style="color:#2aa198">&#34;Host&#34;</span>, <span style="color:#2aa198">&#34;User-Agent&#34;</span>, <span style="color:#2aa198">&#34;Content-Length&#34;</span>, <span style="color:#2aa198">&#34;Content-Type&#34;</span>, <span style="color:#2aa198">&#34;Accept&#34;</span>),
    request.getHeaders().getHeaderNames());
</pre>
<h3>Specify a specific encoding for header values</h3>

<p>By default, HTTP headers&rsquo;s values are decoded using US-ASCII as that is the <a href="https://tools.ietf.org/html/rfc7230#section-3.2.4">recommendation</a>.</p>

<p>If you need to support other encodings, use a custom <code>RawHttp</code> instance to parse messages, as follows:</p>
<pre style="color:#93a1a1;background-color:#002b36">var <span style="color:#268bd2">http</span> <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> RawHttp(RawHttpOptions.newBuilder()
        .withHttpHeadersOptions()
        .withValuesCharset(StandardCharsets.UTF_8)
        .done()
        .build());

<span style="color:#586e75">// now this will be allowed
</span><span style="color:#586e75"></span>http.parseRequest(<span style="color:#2aa198">&#34;&#34;</span><span style="color:#2aa198">&#34;
</span><span style="color:#2aa198">     GET / HTTP/1.1
</span><span style="color:#2aa198">     Accept: こんにちは, text/plain
</span><span style="color:#2aa198">     User-Agent: RawHTTP
</span><span style="color:#2aa198">     Host: localhost:$serverPort&#34;</span><span style="color:#2aa198">&#34;&#34;</span>);
</pre>
<h3>Listen for HTTP requests (as a server)</h3>
<pre style="color:#93a1a1;background-color:#002b36"><span style="color:#719e07">import</span> <span style="color:#268bd2">rawhttp</span>.core.<span style="color:#719e07">*</span>;
<span style="color:#719e07">import</span> <span style="color:#268bd2">java</span>.net.ServerSocket;

ServerSocket <span style="color:#268bd2">serverSocket</span> <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> ServerSocket(8082);
RawHttp <span style="color:#268bd2">http</span> <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> RawHttp();
Socket <span style="color:#268bd2">client</span> <span style="color:#719e07">=</span> serverSocket.accept();
RawHttpRequest <span style="color:#268bd2">request</span> <span style="color:#719e07">=</span> http.parseRequest(client.getInputStream());
</pre>
<h3>Respond to a HTTP request</h3>

<p>&hellip; continues from the previous example:</p>
<pre style="color:#93a1a1;background-color:#002b36"><span style="color:#719e07">import</span> <span style="color:#268bd2">java</span>.time.<span style="color:#719e07">*</span>;
<span style="color:#719e07">import</span> <span style="color:#268bd2">static</span> java.time.format.DateTimeFormatter.RFC_1123_DATE_TIME;

String <span style="color:#268bd2">body</span> <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;Hello RawHTTP!&#34;</span>;
String <span style="color:#268bd2">dateString</span> <span style="color:#719e07">=</span> RFC_1123_DATE_TIME.format(ZonedDateTime.now(ZoneOffset.UTC));
RawHttpResponse<span style="color:#719e07">&lt;</span><span style="color:#719e07">?</span><span style="color:#719e07">&gt;</span> response <span style="color:#719e07">=</span> http.parseResponse(
    <span style="color:#2aa198">&#34;HTTP/1.1 200 OK\r\n&#34;</span> <span style="color:#719e07">+</span>
    <span style="color:#2aa198">&#34;Content-Type: plain/text\r\n&#34;</span> <span style="color:#719e07">+</span>
    <span style="color:#2aa198">&#34;Content-Length: &#34;</span> <span style="color:#719e07">+</span> body.length() <span style="color:#719e07">+</span> <span style="color:#2aa198">&#34;\r\n&#34;</span> <span style="color:#719e07">+</span>
    <span style="color:#2aa198">&#34;Server: RawHTTP\r\n&#34;</span> <span style="color:#719e07">+</span>
    <span style="color:#2aa198">&#34;Date: &#34;</span> <span style="color:#719e07">+</span> dateString <span style="color:#719e07">+</span> <span style="color:#2aa198">&#34;\r\n&#34;</span> <span style="color:#719e07">+</span>
    <span style="color:#2aa198">&#34;\r\n&#34;</span> <span style="color:#719e07">+</span>
    body);
response.writeTo(client.getOutputStream());
</pre>
<hr>
</div>
<footer class="footer">
    <div>
        <small>
            RawHTTP is a project by <a href="https://github.com/renatoathaydes">Renato Athaydes</a>
        </small>
    </div>
    <div>
        <small>Sources on <a href="https://github.com/renatoathaydes/rawhttp">GitHub</a></small>
    </div>
</footer>
</body>
</html>