plugins {
    id 'java'
    id "org.jetbrains.kotlin.jvm"
}

version '0.1.0-SNAPSHOT'
description 'rawhttp-duplex provides a mechanism for full duplex communications based on the ' +
        'HTTP/1.1 chunked transfer-encoding.'

compileTestKotlin {
    kotlinOptions.jvmTarget = '1.8'
}

repositories {
    jcenter()
    mavenLocal()
}

configurations.create('exampleApp')

dependencies {
    compile project(':rawhttp-core')
    compileOnly 'com.google.code.findbugs:jsr305:3.0.2'
    testCompile "io.kotlintest:kotlintest:2.0.7", {
        exclude group: 'org.jetbrains.kotlin'
    }
    testCompile "org.jetbrains.kotlin:kotlin-stdlib-jdk8"
    testCompile "org.jetbrains.kotlin:kotlin-reflect"

    exampleApp project(':rawhttp-core')
    exampleApp "org.jetbrains.kotlin:kotlin-stdlib-jdk8"
}

task chatAppFatJar(type: Jar) {
    dependsOn 'compileTestKotlin'
    manifest {
        attributes 'Main-Class': 'Chat_exampleKt'
    }

    archiveName = 'chat-app.jar'

    from jar
    from compileTestKotlin
    from { configurations.exampleApp.collect { it.isDirectory() ? it : zipTree(it) } }
    with jar
}